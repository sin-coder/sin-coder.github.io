<!doctype html>
<html lang="en-us">
  <head>
    <title>TiDB架构原理简介 // sin-coder</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.59.1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="csuyzz" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://sin-coder.github.io/css/main.min.f90f5edd436ec7b74ad05479a05705770306911f721193e7845948fb07fe1335.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="TiDB架构原理简介"/>
<meta name="twitter:description" content="一、TiDB主要特性  TiDB是一个开源分布式关系型数据库，它主要用来应用在全部的OLTP的场景和大部
 分的OLAP场景。TiDB作为一个开源的分布式数据库主要有以下特点：
1、高度兼容MySQL  MySQL迁移到TiDB是非常容易的，无论是单机迁移还是集群的迁移
 2、支持无限的水平弹性扩展  新增节点实现TiDB的水平扩展，轻松地应对高并发、海量数据的场景
 3、强一致性和高可用  基于Raft的多数派选举协议可以提供100%的数据强一致性，可以实现故障的自动恢复
 4、分布式事务  支持ACID事务
TiDB这些特性使它成为业界认可的优秀数据库产品，但是我们要想深入理解这些特性，
 还要从架构原理的角度学习
二、TiDB的架构原理简介  TiDB集群主要包括三个核心组件：TiDB Server,PD Server,TiKV Server
具体的架构原理图如下所示：
 1、TiDB Server  TiDB Server 负责接收SQL请求，处理SQL相关的逻辑，并通过PD找到存储计算所需
 数据的TiKV地址，与TiKV交互数据，最终返回结果。
 TiDB Server 是无状态的，其本身并不存储数据，只负责计算，可以无限水平扩展，
 可通过负载均衡的组件(LVS、HAProxy或者F5)对外提供统一的接入地址
2、PD Server(Placement Driver)  PD是整个集群的管理模块，具体的工作职能是：
  存储这个集群的原信息(某个Key具体存储在哪个TiKV的节点)
 对TiKV集群进行调度和负载均衡(数据迁移、Raft Group leader)
 分配全局唯一且递增的事物ID
   PD通过Raft协议保证数据的安全性,Raft的leader Server负责处理所有操作，其余的PD
 Server仅用于保证高可用性。一般情况下建议部署奇数个节点
3、TiKV Server  TiKV Server是TiDB中的数据存储引擎，存储的数据的基本单位是Region"/>

    <meta property="og:title" content="TiDB架构原理简介" />
<meta property="og:description" content="一、TiDB主要特性  TiDB是一个开源分布式关系型数据库，它主要用来应用在全部的OLTP的场景和大部
 分的OLAP场景。TiDB作为一个开源的分布式数据库主要有以下特点：
1、高度兼容MySQL  MySQL迁移到TiDB是非常容易的，无论是单机迁移还是集群的迁移
 2、支持无限的水平弹性扩展  新增节点实现TiDB的水平扩展，轻松地应对高并发、海量数据的场景
 3、强一致性和高可用  基于Raft的多数派选举协议可以提供100%的数据强一致性，可以实现故障的自动恢复
 4、分布式事务  支持ACID事务
TiDB这些特性使它成为业界认可的优秀数据库产品，但是我们要想深入理解这些特性，
 还要从架构原理的角度学习
二、TiDB的架构原理简介  TiDB集群主要包括三个核心组件：TiDB Server,PD Server,TiKV Server
具体的架构原理图如下所示：
 1、TiDB Server  TiDB Server 负责接收SQL请求，处理SQL相关的逻辑，并通过PD找到存储计算所需
 数据的TiKV地址，与TiKV交互数据，最终返回结果。
 TiDB Server 是无状态的，其本身并不存储数据，只负责计算，可以无限水平扩展，
 可通过负载均衡的组件(LVS、HAProxy或者F5)对外提供统一的接入地址
2、PD Server(Placement Driver)  PD是整个集群的管理模块，具体的工作职能是：
  存储这个集群的原信息(某个Key具体存储在哪个TiKV的节点)
 对TiKV集群进行调度和负载均衡(数据迁移、Raft Group leader)
 分配全局唯一且递增的事物ID
   PD通过Raft协议保证数据的安全性,Raft的leader Server负责处理所有操作，其余的PD
 Server仅用于保证高可用性。一般情况下建议部署奇数个节点
3、TiKV Server  TiKV Server是TiDB中的数据存储引擎，存储的数据的基本单位是Region" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sin-coder.github.io/database/tidbinfr/" />
<meta property="article:published_time" content="2020-04-24T00:52:37+08:00" />
<meta property="article:modified_time" content="2020-04-24T00:52:37+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://sin-coder.github.io"><img class="app-header-avatar" src="/cat.jpg" alt="csuyzz" /></a>
      <h1>sin-coder</h1>
      <p>I always remember that &#39;Talk is cheap,show me the code&#39;</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/sin-coder" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="mailto:csuyzz@foxmail.com" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-mail">
  <title>mail</title>
  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline>
</svg></a>
        
          <a target="_blank" href="https://cn.linkedin.com/in/csuyzz" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>linkedin</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg></a>
        
          <a target="_blank" href="https://twitter.com/csuyzz1" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg></a>
        
      </div>
      <h3><a href="/" title="首页">首页</a></h3>
      <h3><a href="/category/content/" title="首页">分类目录</a></h3>
      <h3><a href="/personal/introduce/" title="首页">个人简介</a></h3>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">TiDB架构原理简介</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Apr 24, 2020
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          1 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://sin-coder.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><a class="tag" href="https://sin-coder.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a></div></div>
    </header>
    <div class="post-content">
      

<hr />

<h3 id="一-tidb主要特性">一、TiDB主要特性</h3>

<blockquote>
<p>TiDB是一个开源分布式关系型数据库，它主要用来应用在全部的OLTP的场景和大部</p>
</blockquote>

<p>分的OLAP场景。TiDB作为一个开源的分布式数据库主要有以下特点：</p>

<h4 id="1-高度兼容mysql">1、高度兼容MySQL</h4>

<blockquote>
<p>MySQL迁移到TiDB是非常容易的，无论是单机迁移还是集群的迁移</p>
</blockquote>

<h4 id="2-支持无限的水平弹性扩展">2、支持无限的水平弹性扩展</h4>

<blockquote>
<p>新增节点实现TiDB的水平扩展，轻松地应对高并发、海量数据的场景</p>
</blockquote>

<h4 id="3-强一致性和高可用">3、强一致性和高可用</h4>

<blockquote>
<p>基于Raft的多数派选举协议可以提供100%的数据强一致性，可以实现故障的自动恢复</p>
</blockquote>

<h4 id="4-分布式事务">4、分布式事务</h4>

<blockquote>
<p>支持ACID事务</p>

<p>TiDB这些特性使它成为业界认可的优秀数据库产品，但是我们要想深入理解这些特性，</p>
</blockquote>

<p>还要从架构原理的角度学习</p>

<h3 id="二-tidb的架构原理简介">二、TiDB的架构原理简介</h3>

<blockquote>
<p>TiDB集群主要包括三个核心组件：TiDB Server,PD Server,TiKV Server</p>

<p>具体的架构原理图如下所示：</p>
</blockquote>

<p><img src="https://s1.ax1x.com/2020/04/24/JD3Gb8.png" alt="JD3Gb8.png" style="zoom:80%;" /></p>

<h4 id="1-tidb-server">1、TiDB Server</h4>

<blockquote>
<p>TiDB Server 负责接收SQL请求，处理SQL相关的逻辑，并通过PD找到存储计算所需</p>
</blockquote>

<p>数据的TiKV地址，与TiKV交互数据，最终返回结果。</p>

<blockquote>
<p>TiDB Server 是无状态的，其本身并不存储数据，只负责计算，可以无限水平扩展，</p>
</blockquote>

<p>可通过负载均衡的组件(LVS、HAProxy或者F5)对外提供统一的接入地址</p>

<h4 id="2-pd-server-placement-driver">2、PD Server(Placement Driver)</h4>

<blockquote>
<p>PD是整个集群的管理模块，具体的工作职能是：</p>
</blockquote>

<ul>
<li><p>存储这个集群的原信息(某个Key具体存储在哪个TiKV的节点)</p></li>

<li><p>对TiKV集群进行调度和负载均衡(数据迁移、Raft Group leader)</p></li>

<li><p>分配全局唯一且递增的事物ID</p></li>
</ul>

<blockquote>
<p>PD通过Raft协议保证数据的安全性,Raft的leader Server负责处理所有操作，其余的PD</p>
</blockquote>

<p>Server仅用于保证高可用性。一般情况下建议部署奇数个节点</p>

<h4 id="3-tikv-server">3、TiKV Server</h4>

<blockquote>
<p>TiKV Server是TiDB中的数据存储引擎，存储的数据的基本单位是Region</p>

<p>TiKV使用Raft做协议复制，保证数据的一致性和容灾。副本以Region为单位进行管理，</p>
</blockquote>

<p>不同节点上的多个Region构成一个Raft Group，互为副本</p>

<blockquote>
<p>数据在多个TiKV之间的负载均衡由PD调度，也是以Region为基本单位的</p>
</blockquote>

<h4 id="4-tispark">4、TiSpark</h4>

<blockquote>
<p>主要应用在OLTP和OLAP中</p>
</blockquote>

<h4 id="5-tidb-opeartor">5、TiDB Opeartor</h4>

<blockquote>
<p>提供在主流云基础设施上部署管理TiDB集群的能力集成一键部署、多集群混部、自</p>
</blockquote>

<p>动运维、故障自愈</p>

<h3 id="三-重点特性分析">三、重点特性分析</h3>

<blockquote>
<p>TiDB的两大核心特点就是无限水平扩展和高可用性</p>
</blockquote>

<h4 id="1-无限水平扩展">1、无限水平扩展</h4>

<blockquote>
<p>水平扩展包括计算能力和存储能力。TiDB Server负责处理Server的请求，可以增加</p>
</blockquote>

<p>TiDB Server节点，提高计算能力。TiKV负责存储数据，增加TiKV可以增加存储能力</p>

<h4 id="2-高可用性">2、高可用性</h4>

<blockquote>
<p>TiDB、TiKV和PD这三个组件都能容忍部分实例失效，不影响整个集群的可用性</p>
</blockquote>

<h5 id="1-tidb">(1)TiDB</h5>

<blockquote>
<p>TiDB是无状态的,应该部署至少两个实例，前端通过负载均衡的组件对外提供服务</p>
</blockquote>

<p>如果单次请求失败后，重新连接就可继续获得服务</p>

<h5 id="2-pd">(2)PD</h5>

<blockquote>
<p>PD是一个集群，通过Raft协议保持数据的一致性，当单个实例失效时，如果不是</p>
</blockquote>

<p>Raft的Leader，完全不影响服务。如果是Raft的Leader，会重新选举出Raft的leader,</p>

<p>自动恢复服务，但是PD在选举的过程中无法对外提供服务</p>

<h5 id="3-tikv">(3)TiKV</h5>

<blockquote>
<p>TiKV也是一个集群，通过Raft协议保证数据的一致性，副本数量可配置，默认保持</p>
</blockquote>

<p>三副本，通过PD做负载均衡调度。 单个节点失效时，会影响这个节点上存储的所有</p>

<p>Region。对于Region中的Leader节点，会中断服务，等待重新选举；对于Follower节点，</p>

<p>不会影响服务。如果某个TiKV节点失效时，并且在一段时间内无法恢复，PD会将其上的</p>

<p>数据迁移到其他的TiKV节点上</p>

<hr />

<p>​</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>
<script src="https://utteranc.es/client.js"
        repo="sin-coder/hugocomments"
        issue-term="pathname"
        theme="github-dark"  
        crossorigin="anonymous"
        async>
</script>

    </main>
  </body>
</html>
